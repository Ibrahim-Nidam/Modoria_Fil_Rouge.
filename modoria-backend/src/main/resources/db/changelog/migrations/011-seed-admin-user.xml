<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="011-seed-admin-user" author="modoria">
        <!-- Hash for 'password' -->
        <insert tableName="users">
            <column name="email" value="admin@modoria.com"/>
            <column name="password" value="$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG"/> 
            <column name="first_name" value="Admin"/>
            <column name="last_name" value="User"/>
            <column name="is_enabled" valueBoolean="true"/>
            <column name="phone_number" value="+1234567890"/>
            <column name="created_at" valueDate="2024-01-01T00:00:00"/>
            <column name="updated_at" valueDate="2024-01-01T00:00:00"/>
        </insert>

        <!-- Assign ROLE_ADMIN to the user -->
        <!-- Assuming ROLE_ADMIN ID is 1 or querying it if possible, but standard SQL insert into join table -->
        <!-- We need to fetch the user ID and Role ID. 
             Since liquibase is agnostic, we can assume IDs if auto-increment, or use nested query if supported by liquibase or specific SQL -->
             
        <sql>
            INSERT INTO user_roles (user_id, role_id)
            SELECT u.id, r.id
            FROM users u, roles r
            WHERE u.email = 'admin@modoria.com' AND r.name = 'ROLE_ADMIN';
        </sql>

        <!-- Insert Support User -->
         <insert tableName="users">
            <column name="email" value="support@modoria.com"/>
            <column name="password" value="$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG"/> <!-- 'password' -->
            <column name="first_name" value="Support"/>
            <column name="last_name" value="Agent"/>
            <column name="is_enabled" valueBoolean="true"/>
            <column name="phone_number" value="+0987654321"/>
            <column name="created_at" valueDate="2024-01-01T00:00:00"/>
            <column name="updated_at" valueDate="2024-01-01T00:00:00"/>
        </insert>

        <sql>
            INSERT INTO user_roles (user_id, role_id)
            SELECT u.id, r.id
            FROM users u, roles r
            WHERE u.email = 'support@modoria.com' AND r.name = 'ROLE_SUPPORT';
        </sql>
    </changeSet>
</databaseChangeLog>
